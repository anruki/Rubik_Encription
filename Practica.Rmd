---
title: "Untitled"
author: "Jaime Martinez Torio"
date: "2024-04-12"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(readxl)
library(inspectdf)
library(forecast)

```

En primer lugar, cargamos la serie temporal relacionada con la venta de coches. La bbdd selecionada contiene la siguiente estructura:
  -Month: Fecha del mes (por ejemplo, 2016-01, 2016-02, etc.)
  -Sales: Número de ventas realizadas en ese mes.
```{r}
datos <- read.csv('sales-cars.csv', sep=',')
show_plot(inspect_types(datos))
```

```{r}
# Convertimos la columna 'Month' a formato de fecha
datos$Month <- as.Date(as.character(datos$Month), format="%Y-%m")

# Creamos la serie temporal desde la columna 'Sales'
serie <- ts(datos$Sales, start = c(2016, 1), frequency = 12)

# Descomponemos la serie temporal de forma multiplicativa
comp <- decompose(serie, type = "multiplicative")

# Visualizamos la componente estacional, tendencia y residuales
plot(comp)

# Si necesitas ver los datos reales de un rango específico, ajusta los índices a tu conjunto de datos
test <- data.frame('Reales' = datos$Sales[321:324])  # Ajusta los índices según tu conjunto de datos

# Muestra los valores reales seleccionados
test
```
```{r}
autoplot(serie)
```
La serie temporal muestra una tendencia creciente a lo largo del tiempo, lo que indica que las ventas han estado aumentando. Esto sugiere un crecimiento constante en el periodo cubierto por los datos, desde principios de 2016 hasta finales de 2018.

En cuanto a la estacionalidad, hay fluctuaciones claras y periódicas en los datos, lo que puede sugerir que las ventas son afectadas por factores estacionales. Estas fluctuaciones podrían estar vinculadas a varios factores externos, como campañas de marketing, temporadas de vacaciones, eventos especiales o incluso cambios económicos estacionales que afectan al comportamiento del consumidor.
```{r}
autoplot(comp)
```
  -Datos originales (data): Se observa la serie temporal completa, donde se puede notar las fluctuaciones inherentes y la tendencia general que se ha extraído en la parte inferior. Las fluctuaciones capturan la combinación de la tendencia, estacionalidad y otros factores que afectan a las ventas.
  
  -Tendencia (trend): La línea de tendencia muestra un aumento constante a lo largo del tiempo sin disminuir, lo que sugiere que ha habido un crecimiento sostenido en las ventas durante este período. Este crecimiento podría estar influenciado por factores    como la expansión del mercado, mejoras en el producto o efectividad en la estrategia de ventas.
  
  -Estacionalidad (seasonal): El componente estacional muestra claros patrones que se repiten a lo largo de cada año. Esto indica que las ventas tienen picos y valles regulares a lo largo del tiempo, lo cual es típico de las variaciones estacionales que podrían estar relacionadas con eventos específicos del año, como vacaciones o cambios estacionales que afectan al comportamiento del consumidor.
  
  -Residuos (remainder): Los residuos son las variaciones en los datos después de que se han retirado la tendencia y la estacionalidad. Estos podrían ser debidos a factores irregulares o aleatorios no capturados por los modelos de tendencia y estacionalidad. En la gráfica, los residuos parecen ser bastante estables y no muestran patrones claros, lo que es una buena señal de que la descomposición ha capturado adecuadamente la mayor parte de la información en los datos originales.
  
```{r}
comp$figure
```
Valores cercanos a 1, como 0.9815194 y 0.9795536, sugieren que las ventas en esos meses están muy cerca del promedio anual.Los valores por encima de 1, como 1.1179146, 1.1208343, y 1.2186852, indican que en esos meses las ventas son superiores al promedio anual. Esto podría corresponder a los meses de verano o diciembre.El valor más alto (1.2186852) muestra un aumento de aproximadamente un 22% por encima de la media, lo que es comparable con el aumento del 16% observado en la base de datos de referencia para el periodo de Navidad.

En conclusion, los datos nos un patrón estacional con meses específicos con ventas por encima o por debajo de la media. Sin embargo, las variaciones parecen ser menos extremas en comparación con la base de datos de referencia. Esto podría deberse a diferencias en los productos, los comportamientos de compra de los clientes, o incluso factores geograficos o economicos que afectan a las ventas de diferentes maneras.

```{r}
#Calculamos las autocorrelaciones simples
ggAcf(serie, lag=36)
```

```{r}
#Calculamos las autocorrelaciones parciales
ggPacf(serie, lag=36)
```

```{r}
autoplot(diff(serie))
```

```{r}
autoplot(diff(diff(serie),12))
```

```{r}
#Guardo la serie diferenciada
serie <- diff(diff(serie),12)
#Calculamos las autocorrelaciones simples
ggAcf(serie, lag=36)
```

```{r}
#Calculamos las autocorrelaciones parciales
ggPacf(serie, lag=36)
```

Creamos un primer modelo con las estimaciones que hemos hecho.
```{r}

```

